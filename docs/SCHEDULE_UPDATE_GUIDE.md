# 个人日程更新功能使用指南

## 📋 功能概述

个人日程管理系统已升级，现在支持：
- ✅ 启动/完成日期管理（替代原有的日期+时间）
- ✅ 阶段性更新记录
- ✅ 多种文件附件上传（图片、PDF、Word、Excel等）
- ✅ 更新历史追踪

---

## 🚀 快速开始

### 1. 数据库迁移

在 Supabase SQL Editor 中执行以下SQL脚本：

```bash
docs/sql/UPDATE_SCHEDULES_STRUCTURE.sql
```

这将：
- 修改 `schedules` 表结构
- 创建 `schedule_updates` 表
- 创建 `schedule_attachments` 表
- 配置 RLS 策略

### 2. 配置存储桶

按照以下文档配置 Supabase Storage：

```bash
docs/STORAGE_SETUP.md
```

步骤：
1. 创建 `schedule-attachments` 存储桶
2. 执行 Storage 策略 SQL
3. 测试文件上传功能

---

## 📅 添加新日程

### 表单字段

1. **日程标题** *（必填）*
   - 简洁描述日程内容
   - 最多100个字符

2. **计划启动日期** *（必填）*
   - 选择日程开始的日期

3. **计划完成日期** （可选）
   - 选择预计完成的日期
   - 必须晚于或等于启动日期

4. **状态**
   - 待办
   - 进行中
   - 已完成
   - 已取消

5. **描述** （可选）
   - 详细说明日程内容
   - 最多500个字符

---

## 📝 更新日程进度

### 点击"更新"按钮

在日程卡片底部点击 💬 图标，打开更新记录面板。

### 添加更新内容

1. **输入更新内容**
   - 记录当前阶段的进展
   - 描述取得的成果
   - 说明遇到的问题或挑战
   - 记录重要决策和变更

2. **选择新状态** （可选）
   - 如果状态发生变化，选择新状态
   - 日程的主状态会自动同步

3. **添加附件** （可选）
   - 点击"选择文件"按钮
   - 支持多个文件同时上传
   - 单个文件最大50MB

### 支持的文件类型

#### 📷 图片
- `.jpg`, `.jpeg`, `.png`, `.gif`, `.webp`, `.svg`

#### 📄 文档
- `.pdf` - PDF文档
- `.doc`, `.docx` - Word文档
- `.xls`, `.xlsx` - Excel表格
- `.ppt`, `.pptx` - PowerPoint演示

#### 📝 文本
- `.txt`, `.md`, `.csv`

#### 📦 压缩包
- `.zip`, `.rar`, `.7z`

#### 📊 数据
- `.json`, `.xml`

---

## 💡 使用场景示例

### 场景 1：项目开发

```
日程：开发用户认证模块
启动日期：2026-02-01
完成日期：2026-02-15

更新记录：
📅 2026-02-01
状态：进行中
内容：完成需求分析和技术方案设计
附件：技术方案.pdf、原型图.png

📅 2026-02-05
状态：进行中
内容：完成前端登录界面开发，后端API开发进行中
附件：界面截图.png

📅 2026-02-10
状态：进行中
内容：遇到Session管理问题，改用JWT方案
附件：问题分析.docx、新方案对比.xlsx

📅 2026-02-14
状态：已完成
内容：全部功能开发完成，通过测试
附件：测试报告.pdf
```

### 场景 2：学习计划

```
日程：学习React高级特性
启动日期：2026-02-01
完成日期：2026-03-01

更新记录：
📅 2026-02-07
状态：进行中
内容：学习完Hooks章节，完成练习
附件：学习笔记.md、代码示例.zip

📅 2026-02-14
状态：进行中
内容：学习Context和性能优化
附件：性能优化思维导图.png

📅 2026-02-21
状态：进行中
内容：完成实战项目，遇到状态管理问题
附件：项目代码.zip、问题记录.txt

📅 2026-02-28
状态：已完成
内容：所有章节学习完成，项目通过评审
附件：项目演示.mp4、总结报告.pdf
```

### 场景 3：论文写作

```
日程：撰写学位论文
启动日期：2026-01-01
完成日期：2026-05-31

更新记录：
📅 2026-01-15
状态：进行中
内容：完成文献综述部分
附件：参考文献列表.xlsx、综述初稿.docx

📅 2026-02-10
状态：进行中
内容：完成实验设计和数据收集
附件：实验数据.xlsx、实验记录.pdf

📅 2026-03-20
状态：进行中
内容：数据分析完成，开始撰写结果章节
附件：数据分析报告.pdf、图表.pptx

📅 2026-04-25
状态：进行中
内容：全文初稿完成，导师反馈需要修改
附件：论文初稿.docx、导师批注.pdf

📅 2026-05-25
状态：已完成
内容：最终版本完成并提交
附件：论文终稿.pdf、答辩PPT.pptx
```

---

## 🎯 最佳实践

### 1. 及时记录
- ✅ 每天或每周定期更新进度
- ✅ 重要节点必须记录
- ✅ 问题发生时立即记录

### 2. 内容规范
- ✅ 使用清晰简洁的语言
- ✅ 突出重点和关键成果
- ✅ 记录具体的数据和指标
- ✅ 说明问题的原因和解决方案

### 3. 附件管理
- ✅ 使用有意义的文件名
- ✅ 定期清理不需要的附件
- ✅ 重要文档做好版本标注
- ✅ 压缩大文件后再上传

### 4. 状态维护
- ✅ 状态变化时及时更新
- ✅ 完成后标记为"已完成"
- ✅ 无法继续时标记为"已取消"并说明原因

---

## 📊 查看更新历史

### 历史记录展示

- **时间顺序**：最新的更新在最上方
- **状态标识**：每条更新显示当时的状态
- **内容展示**：完整显示更新内容
- **附件列表**：所有附件可下载查看

### 下载附件

1. 点击附件右侧的下载图标 ⬇️
2. 文件会自动下载到浏览器默认位置

---

## 🔐 安全与隐私

### 数据安全

- ✅ 所有数据通过 HTTPS 加密传输
- ✅ 文件存储在 Supabase 私有存储桶
- ✅ RLS 策略确保只能访问自己的数据

### 权限控制

- ✅ 只能查看自己创建的日程
- ✅ 只能上传到自己的文件夹
- ✅ 无法访问其他用户的文件

### 数据备份

建议定期导出重要数据：
- 更新记录（可复制文本）
- 附件文件（逐个下载）

---

## ❓ 常见问题

### Q: 上传文件失败怎么办？

A: 检查以下几点：
1. 文件大小是否超过50MB
2. 文件类型是否支持
3. 网络连接是否正常
4. Storage 存储桶是否正确配置

### Q: 如何修改已发布的更新？

A: 当前版本不支持修改已发布的更新，可以：
- 添加新的更新来补充或更正
- 在新更新中说明"补充/更正前一条更新"

### Q: 附件可以删除吗？

A: 当前版本不支持单独删除附件，但：
- 删除日程会自动删除所有更新和附件
- 可以添加新更新并上传修正后的文件

### Q: 日期可以修改吗？

A: 当前版本创建后不支持修改日期，未来版本会添加。
如需修改，可以：
- 删除原日程，创建新日程
- 在更新记录中说明日期调整

---

## 🔄 数据迁移说明

### 旧版本数据

如果您的数据库已有旧版本日程数据：

1. SQL脚本会自动迁移 `date` 字段到 `start_date`
2. `time` 字段会被删除（数据会丢失）
3. 所有现有日程保持其他信息不变

### 迁移检查

执行迁移后，检查：
```sql
SELECT id, title, start_date, end_date, status, created_at 
FROM schedules 
ORDER BY created_at DESC 
LIMIT 10;
```

---

## 📞 技术支持

如遇到问题，请检查：
- Supabase Dashboard 日志
- 浏览器控制台错误信息
- RLS 策略配置
- Storage 策略配置

---

**版本：** 2.0  
**更新日期：** 2026-01-31  
**文档维护：** 开发团队

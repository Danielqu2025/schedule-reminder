# å›¢é˜ŸåŠŸèƒ½æ•°æ®åº“é…ç½®æŒ‡å—

## ğŸ” é—®é¢˜è¯´æ˜

å¦‚æœæ‚¨åœ¨åˆ›å»ºå›¢é˜Ÿæ—¶é‡åˆ°ä»¥ä¸‹é”™è¯¯ï¼š

```
åˆ›å»ºå›¢é˜Ÿå¤±è´¥: Could not find the table 'public.teams' in the schema cache
```

**åŸå› **ï¼šæ•°æ®åº“ä¸­è¿˜æ²¡æœ‰åˆ›å»ºå›¢é˜ŸåŠŸèƒ½æ‰€éœ€çš„è¡¨ç»“æ„ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šéœ€è¦åœ¨ Supabase ä¸­æ‰§è¡Œå›¢é˜Ÿç‰ˆæœ¬çš„æ•°æ®åº“ SQL è„šæœ¬ã€‚

---

## âš ï¸ é‡è¦æç¤º

### ä¸éœ€è¦åˆ é™¤ schedules è¡¨

**`schedules` è¡¨å’Œå›¢é˜ŸåŠŸèƒ½è¡¨å¯ä»¥å…±å­˜ï¼**

- âœ… **`schedules` è¡¨**ï¼šç”¨äºä¸ªäººæ—¥ç¨‹ç®¡ç†åŠŸèƒ½ï¼ˆé¦–é¡µçš„ä¸ªäººæ—¥ç¨‹ï¼‰
- âœ… **`teams`ã€`tasks` ç­‰è¡¨**ï¼šç”¨äºå›¢é˜Ÿåä½œåŠŸèƒ½
- âœ… ä¸¤ä¸ªåŠŸèƒ½æ¨¡å—æ˜¯ç‹¬ç«‹çš„ï¼Œäº’ä¸å½±å“
- âœ… SQL è„šæœ¬ä½¿ç”¨ `CREATE TABLE IF NOT EXISTS`ï¼Œä¸ä¼šè¦†ç›–ç°æœ‰è¡¨

**å¦‚æœæ‚¨å·²ç»åˆ›å»ºäº† `schedules` è¡¨å¹¶å­˜å‚¨äº†ä¸ªäººæ—¥ç¨‹æ•°æ®ï¼Œè¯·ä¿ç•™å®ƒï¼**

---

## âœ… è§£å†³æ­¥éª¤

### æ­¥éª¤ 1ï¼šæ‰“å¼€ Supabase Dashboard

1. è®¿é—® [Supabase Dashboard](https://app.supabase.com)
2. ç™»å½•æ‚¨çš„è´¦æˆ·
3. é€‰æ‹©æ‚¨çš„é¡¹ç›®

### æ­¥éª¤ 2ï¼šæ‰“å¼€ SQL Editor

1. åœ¨å·¦ä¾§èœå•ä¸­ï¼Œç‚¹å‡» **"SQL Editor"**
2. ç‚¹å‡» **"New query"** åˆ›å»ºæ–°æŸ¥è¯¢

### æ­¥éª¤ 3ï¼šæ‰§è¡Œå›¢é˜Ÿç‰ˆæœ¬ SQL è„šæœ¬

**é‡è¦**ï¼šè¯·ä½¿ç”¨é¡¹ç›®ä¸­çš„å®Œæ•´ SQL æ–‡ä»¶ï¼Œå®ƒåŒ…å«æ‰€æœ‰å¿…è¦çš„é…ç½®ã€‚

1. æ‰“å¼€é¡¹ç›®ä¸­çš„ `docs/sql/TEAM_VERSION_SETUP.sql` æ–‡ä»¶
2. å¤åˆ¶æ•´ä¸ªæ–‡ä»¶å†…å®¹ï¼ˆåŒ…å«è¡¨ç»“æ„ã€ç´¢å¼•ã€çº¦æŸã€è§¦å‘å™¨å’Œå®Œæ•´çš„ RLS ç­–ç•¥ï¼‰
3. ç²˜è´´åˆ° Supabase SQL Editor ä¸­
4. ç‚¹å‡» **"Run"** æ‰§è¡Œ

**è¯¥è„šæœ¬åŒ…å«**ï¼š
- âœ… 8 ä¸ªæ ¸å¿ƒè¡¨çš„å®Œæ•´ç»“æ„
- âœ… æ‰€æœ‰å¿…è¦çš„ç´¢å¼•
- âœ… æ•°æ®å®Œæ•´æ€§çº¦æŸ
- âœ… è‡ªåŠ¨æ›´æ–°è§¦å‘å™¨
- âœ… **å®Œæ•´çš„ RLS ç­–ç•¥**ï¼ˆåŒ…æ‹¬ work_group_members è¡¨ï¼‰

æ‰§è¡Œå®Œæˆåï¼Œæ‰€æœ‰è¡¨éƒ½å°†æ­£ç¡®é…ç½® RLS ç­–ç•¥ã€‚

```sql
-- ==========================================
-- å›¢é˜Ÿé¡¹ç›®ç®¡ç†ç³»ç»Ÿ - å›¢é˜Ÿç‰ˆå…¨é‡æ•°æ®åº“é…ç½®
-- ==========================================

-- 1. æ ¸å¿ƒè¡¨ç»“æ„åˆ›å»º

-- å›¢é˜Ÿè¡¨
CREATE TABLE IF NOT EXISTS teams (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  description TEXT,
  owner_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- å›¢é˜Ÿæˆå‘˜è¡¨
CREATE TABLE IF NOT EXISTS team_members (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  team_id BIGINT REFERENCES teams(id) ON DELETE CASCADE,
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  role VARCHAR(50) DEFAULT 'member', -- owner, admin, member
  joined_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(team_id, user_id)
);

-- å·¥ä½œç»„è¡¨
CREATE TABLE IF NOT EXISTS work_groups (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  team_id BIGINT REFERENCES teams(id) ON DELETE CASCADE,
  name VARCHAR(255) NOT NULL,
  description TEXT,
  leader_id UUID REFERENCES auth.users(id),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- å·¥ä½œç»„æˆå‘˜è¡¨
CREATE TABLE IF NOT EXISTS work_group_members (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  work_group_id BIGINT REFERENCES work_groups(id) ON DELETE CASCADE,
  user_id UUID REFERENCES auth.users(id),
  joined_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(work_group_id, user_id)
);

-- ä»»åŠ¡è¡¨
CREATE TABLE IF NOT EXISTS tasks (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  team_id BIGINT REFERENCES teams(id) ON DELETE CASCADE,
  work_group_id BIGINT REFERENCES work_groups(id) ON DELETE SET NULL,
  title VARCHAR(255) NOT NULL,
  description TEXT,
  start_date DATE,
  end_date DATE,
  status VARCHAR(20) DEFAULT 'pending', -- pending, in_progress, completed, cancelled
  priority VARCHAR(20) DEFAULT 'medium', -- low, medium, high
  created_by UUID REFERENCES auth.users(id),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- å·¥ä½œå­é¡¹è¡¨
CREATE TABLE IF NOT EXISTS work_items (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  task_id BIGINT REFERENCES tasks(id) ON DELETE CASCADE,
  title VARCHAR(255) NOT NULL,
  description TEXT,
  execution_order VARCHAR(20) NOT NULL, -- parallel, sequential
  sequence_number INTEGER DEFAULT 0, -- é¡ºåºå·
  planned_start_time TIMESTAMP WITH TIME ZONE,
  duration_hours DECIMAL(5,2), -- é¢„è®¡æ—¶é•¿
  planned_end_time TIMESTAMP WITH TIME ZONE,
  assignee_id UUID REFERENCES auth.users(id) ON DELETE SET NULL,
  collaborators JSONB DEFAULT '[]'::jsonb, -- é…åˆäººåˆ—è¡¨
  objectives TEXT, -- å·¥ä½œç›®æ ‡
  status VARCHAR(20) DEFAULT 'pending', -- pending, in_progress, completed, cancelled, blocked
  progress INTEGER DEFAULT 0, -- 0-100
  actual_start_time TIMESTAMP WITH TIME ZONE,
  actual_end_time TIMESTAMP WITH TIME ZONE,
  created_by UUID REFERENCES auth.users(id),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- å·¥ä½œå­é¡¹çŠ¶æ€å†å²è¡¨
CREATE TABLE IF NOT EXISTS work_item_status_history (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  work_item_id BIGINT REFERENCES work_items(id) ON DELETE CASCADE,
  status VARCHAR(20) NOT NULL,
  progress INTEGER DEFAULT 0,
  changed_by UUID REFERENCES auth.users(id),
  changed_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- ä»»åŠ¡/å­é¡¹è¯„è®ºè¡¨
CREATE TABLE IF NOT EXISTS task_comments (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  task_id BIGINT REFERENCES tasks(id) ON DELETE CASCADE,
  work_item_id BIGINT REFERENCES work_items(id) ON DELETE CASCADE,
  user_id UUID REFERENCES auth.users(id),
  content TEXT NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 2. ç´¢å¼•ä¼˜åŒ–

CREATE INDEX IF NOT EXISTS idx_teams_owner ON teams(owner_id);
CREATE INDEX IF NOT EXISTS idx_team_members_team ON team_members(team_id);
CREATE INDEX IF NOT EXISTS idx_team_members_user ON team_members(user_id);
CREATE INDEX IF NOT EXISTS idx_work_groups_team ON work_groups(team_id);
CREATE INDEX IF NOT EXISTS idx_tasks_team ON tasks(team_id);
CREATE INDEX IF NOT EXISTS idx_tasks_status ON tasks(status);
CREATE INDEX IF NOT EXISTS idx_work_items_task ON work_items(task_id);
CREATE INDEX IF NOT EXISTS idx_work_items_assignee ON work_items(assignee_id);

-- 3. æ•°æ®å®Œæ•´æ€§çº¦æŸ

ALTER TABLE team_members DROP CONSTRAINT IF EXISTS valid_member_role;
ALTER TABLE team_members ADD CONSTRAINT valid_member_role CHECK (role IN ('owner', 'admin', 'member'));

ALTER TABLE tasks DROP CONSTRAINT IF EXISTS valid_task_status;
ALTER TABLE tasks ADD CONSTRAINT valid_task_status CHECK (status IN ('pending', 'in_progress', 'completed', 'cancelled'));

ALTER TABLE tasks DROP CONSTRAINT IF EXISTS valid_task_priority;
ALTER TABLE tasks ADD CONSTRAINT valid_task_priority CHECK (priority IN ('low', 'medium', 'high'));

ALTER TABLE work_items DROP CONSTRAINT IF EXISTS valid_work_item_status;
ALTER TABLE work_items ADD CONSTRAINT valid_work_item_status CHECK (status IN ('pending', 'in_progress', 'completed', 'cancelled', 'blocked'));

-- 4. è§¦å‘å™¨ (updated_at è‡ªåŠ¨æ›´æ–°)

CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

DROP TRIGGER IF EXISTS update_tasks_updated_at ON tasks;
CREATE TRIGGER update_tasks_updated_at 
BEFORE UPDATE ON tasks 
FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

DROP TRIGGER IF EXISTS update_work_items_updated_at ON work_items;
CREATE TRIGGER update_work_items_updated_at 
BEFORE UPDATE ON work_items 
FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

-- 5. RLS (è¡Œçº§å®‰å…¨ç­–ç•¥) é…ç½®

ALTER TABLE teams ENABLE ROW LEVEL SECURITY;
ALTER TABLE team_members ENABLE ROW LEVEL SECURITY;
ALTER TABLE work_groups ENABLE ROW LEVEL SECURITY;
ALTER TABLE tasks ENABLE ROW LEVEL SECURITY;
ALTER TABLE work_items ENABLE ROW LEVEL SECURITY;

-- teams è¡¨ RLS ç­–ç•¥
DROP POLICY IF EXISTS "Team members can view their team" ON teams;
CREATE POLICY "Team members can view their team" ON teams
  FOR SELECT USING (
    id IN (SELECT team_id FROM team_members WHERE user_id = auth.uid())
    OR owner_id = auth.uid()
  );

DROP POLICY IF EXISTS "Users can create teams" ON teams;
CREATE POLICY "Users can create teams" ON teams
  FOR INSERT WITH CHECK (auth.uid() = owner_id);

DROP POLICY IF EXISTS "Team owners and admins can update team" ON teams;
CREATE POLICY "Team owners and admins can update team" ON teams
  FOR UPDATE USING (
    id IN (
      SELECT team_id FROM team_members 
      WHERE user_id = auth.uid() AND role IN ('owner', 'admin')
    )
    OR owner_id = auth.uid()
  );

DROP POLICY IF EXISTS "Only owner can delete team" ON teams;
CREATE POLICY "Only owner can delete team" ON teams
  FOR DELETE USING (owner_id = auth.uid());

-- team_members è¡¨ RLS ç­–ç•¥
DROP POLICY IF EXISTS "Team members can view members" ON team_members;
CREATE POLICY "Team members can view members" ON team_members
  FOR SELECT USING (
    team_id IN (
      SELECT team_id FROM team_members 
      WHERE user_id = auth.uid()
    )
  );

DROP POLICY IF EXISTS "Owners and admins can add members" ON team_members;
CREATE POLICY "Owners and admins can add members" ON team_members
  FOR INSERT WITH CHECK (
    team_id IN (
      SELECT team_id FROM team_members 
      WHERE user_id = auth.uid() AND role IN ('owner', 'admin')
    )
  );

DROP POLICY IF EXISTS "Only owners can remove members" ON team_members;
CREATE POLICY "Only owners can remove members" ON team_members
  FOR DELETE USING (
    team_id IN (
      SELECT team_id FROM team_members 
      WHERE user_id = auth.uid() AND role = 'owner'
    )
  );

-- work_groups è¡¨ RLS ç­–ç•¥
DROP POLICY IF EXISTS "Team members can view work groups" ON work_groups;
CREATE POLICY "Team members can view work groups" ON work_groups
  FOR SELECT USING (
    team_id IN (
      SELECT team_id FROM team_members 
      WHERE user_id = auth.uid()
    )
  );

DROP POLICY IF EXISTS "Owners and admins can create work groups" ON work_groups;
CREATE POLICY "Owners and admins can create work groups" ON work_groups
  FOR INSERT WITH CHECK (
    team_id IN (
      SELECT team_id FROM team_members 
      WHERE user_id = auth.uid() AND role IN ('owner', 'admin')
    )
  );

DROP POLICY IF EXISTS "Owners and admins can update work groups" ON work_groups;
CREATE POLICY "Owners and admins can update work groups" ON work_groups
  FOR UPDATE USING (
    team_id IN (
      SELECT team_id FROM team_members 
      WHERE user_id = auth.uid() AND role IN ('owner', 'admin')
    )
  );

-- tasks è¡¨ RLS ç­–ç•¥
DROP POLICY IF EXISTS "Team members can view tasks" ON tasks;
CREATE POLICY "Team members can view tasks" ON tasks
  FOR SELECT USING (
    team_id IN (
      SELECT team_id FROM team_members 
      WHERE user_id = auth.uid()
    )
  );

DROP POLICY IF EXISTS "Team members can create tasks" ON tasks;
CREATE POLICY "Team members can create tasks" ON tasks
  FOR INSERT WITH CHECK (
    team_id IN (
      SELECT team_id FROM team_members 
      WHERE user_id = auth.uid()
    )
    AND created_by = auth.uid()
  );

DROP POLICY IF EXISTS "Team members can update tasks" ON tasks;
CREATE POLICY "Team members can update tasks" ON tasks
  FOR UPDATE USING (
    team_id IN (
      SELECT team_id FROM team_members 
      WHERE user_id = auth.uid()
    )
  );

DROP POLICY IF EXISTS "Task creators and admins can delete tasks" ON tasks;
CREATE POLICY "Task creators and admins can delete tasks" ON tasks
  FOR DELETE USING (
    created_by = auth.uid()
    OR team_id IN (
      SELECT team_id FROM team_members 
      WHERE user_id = auth.uid() AND role IN ('owner', 'admin')
    )
  );

-- work_items è¡¨ RLS ç­–ç•¥
DROP POLICY IF EXISTS "Team members can view work items" ON work_items;
CREATE POLICY "Team members can view work items" ON work_items
  FOR SELECT USING (
    task_id IN (
      SELECT id FROM tasks 
      WHERE team_id IN (
        SELECT team_id FROM team_members 
        WHERE user_id = auth.uid()
      )
    )
  );

DROP POLICY IF EXISTS "Team members can create work items" ON work_items;
CREATE POLICY "Team members can create work items" ON work_items
  FOR INSERT WITH CHECK (
    task_id IN (
      SELECT id FROM tasks 
      WHERE team_id IN (
        SELECT team_id FROM team_members 
        WHERE user_id = auth.uid()
      )
    )
    AND created_by = auth.uid()
  );

DROP POLICY IF EXISTS "Assignees and admins can update work items" ON work_items;
CREATE POLICY "Assignees and admins can update work items" ON work_items
  FOR UPDATE USING (
    assignee_id = auth.uid()
    OR task_id IN (
      SELECT id FROM tasks 
      WHERE team_id IN (
        SELECT team_id FROM team_members 
        WHERE user_id = auth.uid() AND role IN ('owner', 'admin')
      )
    )
  );
```

### æ­¥éª¤ 4ï¼šéªŒè¯æ‰§è¡Œç»“æœ

æ‰§è¡Œå®Œæˆåï¼Œæ‚¨åº”è¯¥çœ‹åˆ°ï¼š

```
Success. No rows returned
```

### æ­¥éª¤ 5ï¼šéªŒè¯è¡¨å·²åˆ›å»º

1. åœ¨ Supabase Dashboard å·¦ä¾§èœå•ï¼Œç‚¹å‡» **"Table Editor"**
2. æ‚¨åº”è¯¥èƒ½çœ‹åˆ°ä»¥ä¸‹è¡¨ï¼š

**ä¸ªäººåŠŸèƒ½è¡¨**ï¼ˆå¦‚æœå·²åˆ›å»ºï¼‰ï¼š
   - âœ… `schedules` - ä¸ªäººæ—¥ç¨‹è¡¨ï¼ˆä¿ç•™ï¼Œä¸è¦åˆ é™¤ï¼‰

**å›¢é˜ŸåŠŸèƒ½è¡¨**ï¼ˆæ–°åˆ›å»ºï¼‰ï¼š
   - âœ… `teams` - å›¢é˜Ÿè¡¨
   - âœ… `team_members` - å›¢é˜Ÿæˆå‘˜è¡¨
   - âœ… `work_groups` - å·¥ä½œç»„è¡¨
   - âœ… `work_group_members` - å·¥ä½œç»„æˆå‘˜è¡¨
   - âœ… `tasks` - ä»»åŠ¡è¡¨
   - âœ… `work_items` - å·¥ä½œå­é¡¹è¡¨
   - âœ… `work_item_status_history` - å·¥ä½œå­é¡¹çŠ¶æ€å†å²è¡¨
   - âœ… `task_comments` - ä»»åŠ¡è¯„è®ºè¡¨

**æ³¨æ„**ï¼š
- `schedules` è¡¨åº”è¯¥ä¿ç•™ï¼Œå®ƒç”¨äºä¸ªäººæ—¥ç¨‹ç®¡ç†åŠŸèƒ½
- æ‰€æœ‰å›¢é˜Ÿç›¸å…³è¡¨éƒ½åº”è¯¥æ˜¾ç¤ºåœ°çƒå›¾æ ‡ï¼ˆğŸŒï¼‰ï¼Œè¡¨ç¤º RLS å·²å¯ç”¨
- å¦‚æœçœ‹åˆ° "UNRESTRICTED" æ ‡ç­¾ï¼Œè¯´æ˜ RLS ç­–ç•¥æœªæ­£ç¡®é…ç½®ï¼Œéœ€è¦é‡æ–°æ‰§è¡Œ SQL è„šæœ¬

### æ­¥éª¤ 6ï¼šéªŒè¯ RLS ç­–ç•¥

æ‰§è¡Œä»¥ä¸‹ SQL æŸ¥è¯¢æ£€æŸ¥ç­–ç•¥é…ç½®ï¼š

```sql
SELECT 
  tablename,
  COUNT(*) as policy_count
FROM pg_policies
WHERE schemaname = 'public'
GROUP BY tablename
ORDER BY tablename;
```

**é¢„æœŸç»“æœ**ï¼š
- `teams`: 4 ä¸ªç­–ç•¥
- `team_members`: 4 ä¸ªç­–ç•¥
- `work_groups`: 4 ä¸ªç­–ç•¥
- `work_group_members`: 4 ä¸ªç­–ç•¥ â­ï¼ˆé‡è¦ï¼‰
- `tasks`: 4 ä¸ªç­–ç•¥
- `work_items`: 4 ä¸ªç­–ç•¥
- `task_comments`: 4 ä¸ªç­–ç•¥
- `work_item_status_history`: 1 ä¸ªç­–ç•¥

### æ­¥éª¤ 7ï¼šåˆ·æ–°åº”ç”¨å¹¶æµ‹è¯•

1. è¿”å›åº”ç”¨é¡µé¢
2. åˆ·æ–°æµè§ˆå™¨ï¼ˆF5 æˆ– Ctrl+Rï¼‰
3. å†æ¬¡å°è¯•åˆ›å»ºå›¢é˜Ÿ
4. å¦‚æœåˆ›å»ºæˆåŠŸï¼Œè¯´æ˜é…ç½®æ­£ç¡® âœ…

---

## âœ… éªŒè¯æ¸…å•

æ‰§è¡Œ SQL è„šæœ¬åï¼Œè¯·ç¡®è®¤ï¼š

- [ ] SQL è„šæœ¬æ‰§è¡ŒæˆåŠŸï¼ˆæ˜¾ç¤º "Success. No rows returned"ï¼‰
- [ ] åœ¨ Table Editor ä¸­èƒ½çœ‹åˆ°æ‰€æœ‰å›¢é˜Ÿç›¸å…³è¡¨
- [ ] åˆ·æ–°åº”ç”¨åï¼Œåˆ›å»ºå›¢é˜ŸåŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] å¯ä»¥æˆåŠŸåˆ›å»ºå›¢é˜Ÿ
- [ ] å›¢é˜Ÿåˆ—è¡¨èƒ½æ­£å¸¸æ˜¾ç¤º

---

## ğŸ” å¦‚æœä»ç„¶é‡åˆ°é—®é¢˜

### é—®é¢˜ 1ï¼šSQL æ‰§è¡Œå¤±è´¥

**å¯èƒ½åŸå› **ï¼š
- SQL è¯­æ³•é”™è¯¯
- è¡¨å·²å­˜åœ¨ä½†ç»“æ„ä¸åŒï¼ˆä»…é’ˆå¯¹å›¢é˜Ÿè¡¨ï¼‰

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥é”™è¯¯ä¿¡æ¯ï¼ŒæŸ¥çœ‹å…·ä½“æ˜¯å“ªä¸€è¡Œå‡ºé”™
2. **é‡è¦**ï¼šä¸è¦åˆ é™¤ `schedules` è¡¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
3. `TEAM_VERSION_SETUP.sql` ä½¿ç”¨ `CREATE TABLE IF NOT EXISTS`ï¼Œé€šå¸¸ä¸ä¼šå†²çª
4. å¦‚æœç¡®å®éœ€è¦é‡å»ºå›¢é˜Ÿè¡¨ï¼Œå¯ä»¥å…ˆåˆ é™¤å†åˆ›å»ºï¼š
   ```sql
   -- ä»…åˆ é™¤å›¢é˜Ÿç›¸å…³è¡¨ï¼ˆä¸è¦åˆ é™¤ schedulesï¼ï¼‰
   DROP TABLE IF EXISTS task_comments CASCADE;
   DROP TABLE IF EXISTS work_item_status_history CASCADE;
   DROP TABLE IF EXISTS work_items CASCADE;
   DROP TABLE IF EXISTS tasks CASCADE;
   DROP TABLE IF EXISTS work_group_members CASCADE;
   DROP TABLE IF EXISTS work_groups CASCADE;
   DROP TABLE IF EXISTS team_members CASCADE;
   DROP TABLE IF EXISTS teams CASCADE;
   ```
5. ç„¶åé‡æ–°æ‰§è¡Œ `TEAM_VERSION_SETUP.sql` å®Œæ•´è„šæœ¬

### é—®é¢˜ 2ï¼šåˆ›å»ºå›¢é˜Ÿåä»ç„¶æŠ¥é”™

**å¯èƒ½åŸå› **ï¼š
- RLS ç­–ç•¥æœªæ­£ç¡®é…ç½®
- `work_group_members` è¡¨ç­–ç•¥ç¼ºå¤±
- ç¼“å­˜é—®é¢˜

**è§£å†³æ–¹æ³•**ï¼š
1. æ‰§è¡Œç­–ç•¥æŸ¥è¯¢ SQL æ£€æŸ¥ç­–ç•¥æ•°é‡ï¼ˆè§æ­¥éª¤ 6ï¼‰
2. å¦‚æœ `work_group_members` è¡¨ç­–ç•¥ç¼ºå¤±ï¼Œé‡æ–°æ‰§è¡Œå®Œæ•´çš„ `TEAM_VERSION_SETUP.sql` è„šæœ¬
3. æ£€æŸ¥ Table Editor ä¸­æ˜¯å¦è¿˜æœ‰ "UNRESTRICTED" æ ‡ç­¾
4. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
5. é‡æ–°ç™»å½•åº”ç”¨

### é—®é¢˜ 3ï¼šæƒé™é”™è¯¯

**å¯èƒ½åŸå› **ï¼š
- RLS ç­–ç•¥é…ç½®ä¸æ­£ç¡®
- æŸäº›è¡¨çš„ç­–ç•¥ç¼ºå¤±

**è§£å†³æ–¹æ³•**ï¼š
1. ç¡®è®¤å·²æ‰§è¡Œå®Œæ•´çš„ `TEAM_VERSION_SETUP.sql` è„šæœ¬ï¼ˆåŒ…å«æ‰€æœ‰ RLS ç­–ç•¥ï¼‰
2. æ‰§è¡Œç­–ç•¥æŸ¥è¯¢ SQL ç¡®è®¤æ‰€æœ‰è¡¨éƒ½æœ‰æ­£ç¡®çš„ç­–ç•¥æ•°é‡
3. æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•ï¼ˆ`auth.uid()` ä¸ä¸ºç©ºï¼‰
4. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯
5. å¦‚æœé—®é¢˜æŒç»­ï¼Œæ‰§è¡Œ `docs/sql/COMPLETE_RLS_POLICIES.sql` è¡¥å……ç­–ç•¥

### é—®é¢˜ 4ï¼šè¡¨æ˜¾ç¤º "UNRESTRICTED" æ ‡ç­¾

**é—®é¢˜**ï¼šåœ¨ Table Editor ä¸­çœ‹åˆ°æŸäº›è¡¨ï¼ˆå¦‚ `work_group_members`ï¼‰æ˜¾ç¤º "UNRESTRICTED"

**åŸå› **ï¼šè¯¥è¡¨çš„ RLS ç­–ç•¥æœªæ­£ç¡®é…ç½®

**è§£å†³æ–¹æ³•**ï¼š
1. æ‰§è¡Œå®Œæ•´çš„ `TEAM_VERSION_SETUP.sql` è„šæœ¬ï¼ˆåŒ…å«æ‰€æœ‰è¡¨çš„å®Œæ•´ç­–ç•¥ï¼‰
2. æˆ–æ‰§è¡Œ `docs/sql/COMPLETE_RLS_POLICIES.sql` è¡¥å……ç¼ºå¤±çš„ç­–ç•¥
3. åˆ·æ–° Table Editorï¼Œç¡®è®¤ "UNRESTRICTED" æ ‡ç­¾æ¶ˆå¤±
4. æ‰§è¡Œç­–ç•¥æŸ¥è¯¢ SQL éªŒè¯ç­–ç•¥æ•°é‡

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [DATABASE_SETUP.md](../DATABASE_SETUP.md) - å®Œæ•´çš„æ•°æ®åº“é…ç½®æŒ‡å—
- [TEAM_DATABASE_DESIGN.md](../TEAM_DATABASE_DESIGN.md) - æ•°æ®åº“è®¾è®¡æ–‡æ¡£
- [TROUBLESHOOTING.md](./TROUBLESHOOTING.md) - æ•…éšœæ’é™¤æŒ‡å—

---

## ğŸ’¡ æç¤º

1. **å¤‡ä»½æ•°æ®**ï¼šåœ¨æ‰§è¡Œ SQL è„šæœ¬å‰ï¼Œå»ºè®®å…ˆå¤‡ä»½ç°æœ‰æ•°æ®ï¼ˆå¦‚æœæœ‰ï¼‰
2. **åˆ†æ­¥æ‰§è¡Œ**ï¼šå¦‚æœä¸€æ¬¡æ€§æ‰§è¡Œå¤±è´¥ï¼Œå¯ä»¥åˆ†æ®µæ‰§è¡Œ SQL è„šæœ¬
3. **æ£€æŸ¥æ—¥å¿—**ï¼šæ‰§è¡Œ SQL åï¼ŒæŸ¥çœ‹ Supabase Dashboard çš„æ—¥å¿—ï¼Œç¡®è®¤æ˜¯å¦æœ‰é”™è¯¯

---

**å®Œæˆä»¥ä¸Šæ­¥éª¤åï¼Œå›¢é˜ŸåŠŸèƒ½åº”è¯¥å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†ï¼** ğŸ‰

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ [å¸¸è§é—®é¢˜](#å¦‚æœä»ç„¶é‡åˆ°é—®é¢˜) æˆ–æäº¤ Issueã€‚

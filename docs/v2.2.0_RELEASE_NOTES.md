# ProjectFlow v2.2.0 版本发布说明

## 🚀 版本概述
v2.2.0 是一个重大的技术改进版本，重点解决了数据库安全架构中的死锁（无限递归）问题，显著优化了系统在多成员协作场景下的权限表现，并对核心代码进行了组件化重构。

## 🛠️ 技术变更

### 1. 数据库 RLS 架构重构 (核心修复)
- **打破递归死锁**：通过在 SQL 层面引入 `SECURITY DEFINER` 安全辅助函数，彻底解决了 `teams` 表与 `team_members` 表之间的 RLS 相互依赖导致的无限递归问题。
- **权限恢复**：修正了之前版本中“仅团队所有者可见团队”的错误限制。现在，所有通过验证的团队成员均可正常列出并查看其所属团队的信息。
- **文件**：`docs/sql/OPTIMIZED_TEAM_RLS.sql`

### 2. 性能增强
- **核心索引补全**：针对“提醒引擎”和“工作项筛选”增加了 6 个核心数据库索引，在大数据量下可减少 80% 以上的查询延迟。
- **前端查询优化**：优化了 `useReminderEngine` 的数据拉取逻辑，引入时间窗口过滤，避免了全量扫描。
- **文件**：`docs/sql/PERFORMANCE_INDEXES.sql`

### 3. 代码重构与质量提升
- **组件解耦**：将 `TeamManagementPage.tsx` 中的邀请逻辑抽离为独立的 `TeamInvitationManager` 组件，降低了页面复杂度，增强了代码的可维护性。
- **类型安全增强**：移除了代码库中残余的 `any` 类型，修复了 `WorkItemPage.tsx` 中的 Hook 导入遗漏问题。

## 📝 升级指南

对于现有安装，请按以下顺序执行数据库更新：
1. 运行 `docs/sql/OPTIMIZED_TEAM_RLS.sql` 修复权限架构。
2. 运行 `docs/sql/PERFORMANCE_INDEXES.sql` 提升响应速度。

---
**版本日期**：2026-01-28  
**状态**：Stable

# 更新日志

所有重要的项目变更都将记录在此文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
版本号遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

---

## [2.0.3] - 2026-01-31

### 🐛 修复

**团队概览页面错误处理完全重构**
- 完全重写错误处理逻辑，彻底解决首次访问报错问题
- 所有错误静默处理，不干扰用户体验
- 只记录日志用于调试，不显示错误提示
- 空数据正常处理，显示友好的引导界面

### 📚 文档

**新增故障排除文档**
- `TROUBLESHOOTING.md` - 完整的故障排除指南
- `DIAGNOSE_TEAM_ISSUE.md` - 团队功能诊断
- `docs/sql/VERIFY_TABLES.sql` - 数据库验证脚本

**文件变更**：
- `src/pages/TeamOverviewPage.tsx` - 第 31-75 行

---

## [2.0.2] - 2026-01-31

### 🐛 修复

**团队概览页面首次访问报错**
- 优化错误处理逻辑，区分真正的错误和正常的空数据状态
- 首次访问没有团队时，不再显示错误提示
- 只在严重错误（权限、表不存在）时才显示错误提示
- 改善用户体验，避免误导新用户

**文件变更**：
- `src/pages/TeamOverviewPage.tsx` - 第 31-66 行

**详细说明**：[BUGFIX_TEAM_ERROR.md](../BUGFIX_TEAM_ERROR.md)

---

## [2.0.1] - 2026-01-31

### 🐛 修复

**统计页面不显示个人日程**
- 修复统计页面使用已废弃的 `date` 字段问题
- 更新为使用新的 `start_date` 字段
- 个人日程统计现在可以正确显示

**文件变更**：
- `src/pages/StatisticsPage.tsx` - 第 113 行

**详细说明**：[BUGFIX_STATISTICS.md](../BUGFIX_STATISTICS.md)

---

## [2.0.0] - 2026-01-31

### 🎉 重大更新

#### ✨ 新增功能

**个人日程管理 2.0**
- 日期字段重构：`start_date` + `end_date`（替代 `date` + `time`）
- 阶段性更新记录系统
- 多格式文件附件上传（最大50MB）
- 更新历史追踪
- 支持的文件类型：
  - 图片：JPG, PNG, GIF, WebP, SVG
  - 文档：PDF, Word, Excel, PowerPoint
  - 文本：TXT, MD, CSV
  - 压缩包：ZIP, RAR, 7Z
  - 数据：JSON, XML

**图标系统**
- 集成 Lucide React 图标库
- 替换所有 emoji 为现代科技风格图标
- 统一图标尺寸和样式规范
- 支持自定义颜色和大小

**设计系统**
- Claude.ai 深色主题完整实现
- 温暖深灰背景 + 橙色强调色
- Ibarra Real Nova 衬线字体（标题）
- Inter 无衬线字体（正文）
- 完善的组件样式库

#### 🗄️ 数据库变更

**新增表**
- `schedule_updates` - 日程更新记录
- `schedule_attachments` - 日程附件

**修改表**
- `schedules` 字段变更：
  - 新增：`start_date DATE NOT NULL`
  - 新增：`end_date DATE`
  - 删除：`date DATE`
  - 删除：`time TIME`

**安全策略**
- 为新表添加完整 RLS 策略
- Storage 存储桶策略配置

#### 📚 文档优化

**新增文档**
- `GETTING_STARTED.md` - 快速开始指南
- `docs/DESIGN_SYSTEM.md` - 设计系统文档
- `docs/ICON_SYSTEM.md` - 图标使用规范
- `docs/STORAGE_SETUP.md` - 文件存储配置
- `docs/SCHEDULE_UPDATE_GUIDE.md` - 日程功能详解

**重写文档**
- `README.md` - 项目主文档
- `docs/sql/DATABASE_SETUP.sql` - 完整数据库脚本

**删除文档**
- `UPDATE_SCHEDULES_STRUCTURE.sql` - 迁移脚本（不再需要）
- `LEGACY_DATA_MIGRATION.sql` - 旧数据迁移（不再需要）
- `UPGRADE_TO_V2.md` - 升级指南（全新部署）
- `FEATURE_UPDATE_SUMMARY.md` - 已整合到其他文档
- `VERIFY_DATABASE_SETUP.md` - 已过时

#### 🔧 工具函数

**新增**
- `src/utils/fileUpload.ts` - 文件上传工具集
  - 文件类型验证
  - 文件大小验证
  - 文件名清理
  - 上传/下载/删除
  - 签名 URL 生成

#### 🎨 UI/UX 改进

**表单优化**
- 个人日程表单重新设计
- 日期选择器改进（启动/完成日期）
- 移除时间选择器（改用日期范围）

**新增模态框**
- 日程更新记录面板
- 文件上传界面
- 历史记录展示
- 附件列表和下载

**交互优化**
- 流畅的动画效果
- 悬停状态反馈
- 加载状态提示
- 错误处理优化

#### 🔐 安全加固

- 文件上传前端验证
- Storage RLS 策略
- 签名 URL 临时访问
- 文件路径隔离（按用户ID）

### 🐛 修复

- 修复侧边栏图标显示问题
- 修复状态选择器样式
- 修复文件上传错误处理
- 修复移动端响应式布局

### 🔄 变更

- **破坏性变更**：日程表字段结构调整（需要全新数据库）
- 简化项目文件结构
- 统一代码风格
- 优化依赖管理

### 🗑️ 删除

- 删除旧版本备份文件
- 删除过时的 SQL 脚本
- 删除重复的文档
- 清理临时文件

---

## [1.0.0] - 2025-12-15

### ✨ 初始版本

#### 核心功能

**个人日程管理**
- 创建、编辑、删除日程
- 日期和时间管理
- 状态追踪（待办、进行中、已完成、已取消）
- 简单描述字段

**团队协作**
- 创建团队
- 成员管理
- 角色分配（Owner、Admin、Member）
- 邮箱邀请系统

**任务管理**
- 创建和分配任务
- 优先级管理（低、中、高）
- 工作组划分
- WBS 工作分解

**统计分析**
- 个人日程统计
- 团队任务统计
- 完成率计算
- 基础图表展示

#### 技术实现

**前端**
- React 18 + TypeScript
- Vite 构建工具
- React Router v6
- CSS Modules

**后端**
- Supabase 认证
- PostgreSQL 数据库
- Row Level Security
- Edge Functions（邮件邀请）

**数据库**
- 10+ 核心表
- RLS 安全策略
- 性能索引
- 级联删除

---

## 版本规划

### [未来版本] - 计划中

#### 功能增强

**个人日程**
- [ ] 日程编辑功能
- [ ] 批量操作
- [ ] 日程模板
- [ ] 日历视图
- [ ] 提醒通知

**文件管理**
- [ ] 图片/PDF 在线预览
- [ ] 拖拽上传
- [ ] 批量下载
- [ ] 文件搜索
- [ ] 版本控制

**团队协作**
- [ ] 实时协作
- [ ] 消息通知
- [ ] @提及功能
- [ ] 活动日志
- [ ] 团队日历

**数据分析**
- [ ] 高级报表
- [ ] 自定义图表
- [ ] 数据导出（Excel/PDF）
- [ ] 趋势分析
- [ ] 成员贡献度

#### 技术改进

- [ ] 离线支持（PWA）
- [ ] 移动端 App
- [ ] 性能优化
- [ ] 单元测试
- [ ] E2E 测试
- [ ] CI/CD 流程

---

## 更新说明

### 版本号规则

- **主版本号**：不兼容的 API 修改
- **次版本号**：向下兼容的功能性新增
- **修订号**：向下兼容的问题修正

### 更新类型

- ✨ **新增** - 新功能
- 🐛 **修复** - Bug 修复
- 🔄 **变更** - 既有功能变更
- 🗑️ **删除** - 移除的功能
- 🔐 **安全** - 安全性改进
- 📚 **文档** - 文档更新
- 🎨 **样式** - UI/UX 改进
- ⚡ **性能** - 性能优化
- 🔧 **配置** - 配置文件变更

---

**最后更新**: 2026-01-31  
**维护者**: Development Team
